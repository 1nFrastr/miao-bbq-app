# 小程序订单页面 API 集成

## 功能概述

已完成小程序订单页面与后端API的集成，实现以下功能：

### 1. 用户认证
- 微信登录功能（模拟实现）
- 用户信息存储和管理
- 登录状态检查

### 2. 订单管理
- 创建新订单
- 添加菜品到订单
- 删除订单中的菜品
- 开始订单计时
- 完成订单
- 查看订单列表和详情

### 3. API集成
- 统一的请求封装
- 错误处理和用户提示
- 认证头部自动添加
- 响应数据标准化处理

## 文件结构

```
src/
├── utils/
│   ├── api.ts           # API调用封装
│   ├── auth.ts          # 用户认证服务
│   ├── testData.ts      # 测试数据
│   └── index.ts         # 工具函数
├── types/
│   └── index.ts         # TypeScript类型定义
├── components/
│   ├── LoginModal.tsx   # 登录弹窗组件
│   └── LoginModal.scss  # 登录弹窗样式
└── pages/
    ├── order/           # 订单页面
    │   ├── index.tsx
    │   ├── index.scss
    │   └── index.config.ts
    └── test/            # API测试页面
        ├── index.tsx
        ├── index.scss
        └── index.config.ts
```

## 主要功能

### 订单页面 (pages/order/index.tsx)

**核心功能：**
1. **添加菜品**：用户可以输入菜名、单价和数量，添加到当前订单
2. **订单列表**：显示当前订单中的所有菜品，包括名称、单价、数量和小计
3. **删除菜品**：支持删除订单中的指定菜品
4. **订单状态管理**：
   - `pending`: 未开始（可以添加菜品）
   - `ongoing`: 进行中（计时状态）
   - `completed`: 已完成
5. **计时功能**：开始计时后实时显示等待时间
6. **总金额计算**：自动计算订单总金额

**用户体验：**
- 表单验证：确保输入数据的有效性
- 加载状态：API调用时显示加载状态
- 错误提示：网络错误或操作失败时给出友好提示
- 确认对话框：删除和完成操作前进行确认

### API服务 (utils/api.ts)

**统一请求处理：**
- 自动添加认证头部 (`X-Openid`)
- 统一错误处理和用户提示
- 支持分页响应和普通响应的自动识别
- TypeScript类型安全

**支持的API：**
- 用户相关：登录/注册、获取用户信息、更新资料
- 订单相关：CRUD操作、计时、统计
- 社区相关：分享管理、点赞、评论

### 认证服务 (utils/auth.ts)

**功能：**
- 微信登录集成（当前为模拟实现）
- 用户信息本地存储
- 登录状态检查
- 自动登录提示

## 使用方法

### 1. 启动项目

确保后端服务已启动：
```bash
# 在项目根目录运行
pnpm run backend:start
```

启动小程序开发：
```bash
# 在项目根目录运行
pnpm run dev:weapp
```

### 2. 测试API集成

访问"API测试"页面，点击"运行所有测试"按钮，验证API集成是否正常。

### 3. 使用订单功能

1. 打开"我的订单"页面
2. 如果未登录，系统会提示进行微信登录
3. 填写菜品信息并添加到订单
4. 点击"开始计时"开始订单
5. 可继续添加菜品或删除菜品
6. 点击"完成订单"结束订单

## 注意事项

### 1. 微信登录
当前使用模拟的微信登录，生产环境需要：
- 配置小程序AppID和AppSecret
- 实现真实的微信登录流程
- 调用微信API获取用户信息

### 2. 错误处理
- 网络错误会自动显示toast提示
- API错误会根据后端返回的错误信息显示
- 表单验证失败会显示具体的错误信息

### 3. 数据持久化
- 用户信息存储在本地存储中
- 订单数据通过API与后端同步
- 网络异常时可能出现数据不一致

### 4. 性能优化
- 使用React.memo、useCallback等优化组件性能
- API请求添加了适当的防抖处理
- 图片和静态资源进行了压缩

## 扩展功能

### 可以继续添加的功能：
1. **订单历史**：查看已完成的订单记录
2. **菜品收藏**：收藏常用菜品，快速添加
3. **订单分享**：分享订单到社区
4. **数据统计**：消费统计、偏好分析
5. **离线支持**：网络异常时的本地数据处理
6. **推送通知**：订单状态变化通知

### API扩展：
1. **文件上传**：支持菜品图片上传
2. **实时通信**：WebSocket支持实时订单状态更新  
3. **数据导出**：订单数据导出功能
4. **批量操作**：批量管理订单

## 开发规范

项目遵循Taro编码规范：
- 使用TypeScript开发
- 函数式组件 + Hooks
- SCSS样式预处理
- ESLint代码质量检查
- 统一的错误处理模式
